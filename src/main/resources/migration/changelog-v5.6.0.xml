<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        objectQuotingStrategy="QUOTE_ALL_OBJECTS"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="v5.6.0-1" author="sahibamittal">
        <modifyDataType tableName="AFFECTEDVERSIONATTRIBUTION" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="BOM" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="COMPONENT" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="COMPONENT_PROPERTY" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="FINDINGATTRIBUTION" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="LICENSE" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="LICENSEGROUP" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="NOTIFICATIONPUBLISHER" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="NOTIFICATIONRULE" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="POLICY" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="POLICYCONDITION" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="POLICYVIOLATION" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="PROJECT" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="REPOSITORY" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="SERVICECOMPONENT" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="VEX" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="VULNERABILITY" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="VULNERABILITYALIAS" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="VULNERABILITYSCAN" columnName="TARGET_IDENTIFIER" newDataType="UUID"/>
        <modifyDataType tableName="VULNERABILITYSCAN" columnName="TOKEN" newDataType="UUID"/>
        <modifyDataType tableName="VULNERABLESOFTWARE" columnName="UUID" newDataType="UUID"/>
        <modifyDataType tableName="WORKFLOW_STATE" columnName="TOKEN" newDataType="UUID"/>
    </changeSet>

    <changeSet id="v5.6.0-2" author="nscuro">
        <modifyDataType tableName="TEAM" columnName="NAME" newDataType="VARCHAR(255)"/>
    </changeSet>
  
    <changeSet id="v5.6.0-3" author="rossmurphy974@gmail.com">
        <addColumn tableName="PROJECT">
            <column name="AUTHORS" type="TEXT"/>
        </addColumn>
        <addColumn tableName="COMPONENT">
            <column name="AUTHORS" type="TEXT"/>
        </addColumn>
        
        <sql>
            UPDATE "PROJECT"
            SET "AUTHORS" = JSON_BUILD_ARRAY(JSON_BUILD_OBJECT('name', "AUTHOR"))::TEXT
            WHERE "AUTHOR" IS NOT NULL;
        </sql>
        <sql>
            UPDATE "COMPONENT"
            SET "AUTHORS" = JSON_BUILD_ARRAY(JSON_BUILD_OBJECT('name', "AUTHOR"))::TEXT
            WHERE "AUTHOR" IS NOT NULL;
        </sql>

        <dropColumn tableName="PROJECT">
            <column name="AUTHOR"/>
        </dropColumn>
        <dropColumn tableName="COMPONENT">
            <column name="AUTHOR"/>
        </dropColumn>
    </changeSet>
    
    <changeSet id="v5.6.0-4" author="nscuro">
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_DIRECT_DEPENDENCIES_GIN_IDX"/>
        <modifyDataType tableName="COMPONENT" columnName="DIRECT_DEPENDENCIES" newDataType="JSONB"/>
        <modifyDataType tableName="PROJECT" columnName="DIRECT_DEPENDENCIES" newDataType="JSONB"/>
        <sql splitStatements="true">
            CREATE
             INDEX "COMPONENT_DIRECT_DEPENDENCIES_JSONB_IDX"
                ON "COMPONENT"
             USING GIN("DIRECT_DEPENDENCIES" JSONB_PATH_OPS);
        </sql>
    </changeSet>

    <changeSet id="v5.6.0-5" author="sahibamittal">
        <sql>
            DELETE FROM "CONFIGPROPERTY"
            WHERE "GROUPNAME" = 'artifact'
            AND "PROPERTYNAME" = 'bom.validation.enabled';
        </sql>
    </changeSet>

    <changeSet id="v5.6.0-6" author="sahibamittal">
        <createTable tableName="NOTIFICATIONRULE_TAGS">
            <column name="NOTIFICATIONRULE_ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="TAG_ID" type="BIGINT"/>
        </createTable>

        <createIndex indexName="NOTIFICATIONRULE_TAGS_NOTIFICATIONRULE_ID_IDX" tableName="NOTIFICATIONRULE_TAGS">
            <column name="NOTIFICATIONRULE_ID"/>
        </createIndex>
        <createIndex indexName="NOTIFICATIONRULE_TAGS_TAG_ID_IDX" tableName="NOTIFICATIONRULE_TAGS">
            <column name="TAG_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="NOTIFICATIONRULE_ID" baseTableName="NOTIFICATIONRULE_TAGS"
                                 constraintName="NOTIFICATIONRULE_TAGS_NOTIFICATIONRULE_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="NOTIFICATIONRULE" validate="true"/>

        <addForeignKeyConstraint baseColumnNames="TAG_ID" baseTableName="NOTIFICATIONRULE_TAGS"
                                 constraintName="NOTIFICATIONRULE_TAGS_TAG_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TAG" validate="true"/>
    </changeSet>

    <changeSet id="v5.6.0-7" author="sahibamittal">
        <addColumn tableName="PROJECT">
            <column name="IS_LATEST" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <addColumn tableName="POLICY">
            <column name="ONLY_LATEST_PROJECT_VERSION" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <createIndex indexName="PROJECT_IS_LATEST_IDX" tableName="PROJECT">
            <column name="IS_LATEST"/>
        </createIndex>
    </changeSet>

    <changeSet id="v5.6.0-8" author="nscuro">
        <sql>
            DELETE
              FROM "CONFIGPROPERTY"
             WHERE "GROUPNAME" = 'vuln-source'
               AND "PROPERTYNAME" = 'nvd.feeds.url';
        </sql>
    </changeSet>

    <changeSet id="v5.6.0-9" author="nscuro">
        <sql>
            CREATE INDEX "COMPONENT_PROPERTY_COMPONENT_ID_IDX"
                ON "COMPONENT_PROPERTY" ("COMPONENT_ID");
        </sql>
    </changeSet>

    <changeSet id="v5.6.0-9" author="sahibamittal">
        <addColumn tableName="PROJECT">
            <column name="INACTIVE_SINCE" type="TIMESTAMP WITH TIME ZONE">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    
        <sql>UPDATE "PROJECT" SET "INACTIVE_SINCE" = NOW() WHERE "ACTIVE" IS FALSE</sql>

        <dropColumn tableName="PROJECT">
            <column name="ACTIVE" type="BOOLEAN"/>
        </dropColumn>
    </changeSet>

    <changeSet id="v5.6.0-10" author="nscuro">
        <createIndex tableName="PROJECT_METADATA" indexName="PROJECT_METADATA_PROJECT_ID_IDX" unique="true">
            <column name="PROJECT_ID"/>
        </createIndex>
    </changeSet>

    <changeSet id="v5.6.0-11" author="nscuro">
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_BLAKE2B_256_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_BLAKE2B_384_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_BLAKE2B_512_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_BLAKE3_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_MD5_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_SHA1_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_SHA3_256_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_SHA3_384_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_SHA3_512_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_SHA256_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_SHA384_IDX"/>
        <dropIndex tableName="COMPONENT" indexName="COMPONENT_SHA512_IDX"/>

        <sql splitStatements="true">
            CREATE INDEX "COMPONENT_BLAKE2B_256_IDX" ON "COMPONENT" ("BLAKE2B_256") WHERE "BLAKE2B_256" IS NOT NULL;
            CREATE INDEX "COMPONENT_BLAKE2B_384_IDX" ON "COMPONENT" ("BLAKE2B_384") WHERE "BLAKE2B_384" IS NOT NULL;
            CREATE INDEX "COMPONENT_BLAKE2B_512_IDX" ON "COMPONENT" ("BLAKE2B_512") WHERE "BLAKE2B_512" IS NOT NULL;
            CREATE INDEX "COMPONENT_BLAKE3_IDX" ON "COMPONENT" ("BLAKE3") WHERE "BLAKE3" IS NOT NULL;
            CREATE INDEX "COMPONENT_MD5_IDX" ON "COMPONENT" ("MD5") WHERE "MD5" IS NOT NULL;
            CREATE INDEX "COMPONENT_SHA1_IDX" ON "COMPONENT" ("SHA1") WHERE "SHA1" IS NOT NULL;
            CREATE INDEX "COMPONENT_SHA_256_IDX" ON "COMPONENT" ("SHA_256") WHERE "SHA_256" IS NOT NULL;
            CREATE INDEX "COMPONENT_SHA_384_IDX" ON "COMPONENT" ("SHA_384") WHERE "SHA_384" IS NOT NULL;
            CREATE INDEX "COMPONENT_SHA_512_IDX" ON "COMPONENT" ("SHA_512") WHERE "SHA_512" IS NOT NULL;
            CREATE INDEX "COMPONENT_SHA3_256_IDX" ON "COMPONENT" ("SHA3_256") WHERE "SHA3_256" IS NOT NULL;
            CREATE INDEX "COMPONENT_SHA3_384_IDX" ON "COMPONENT" ("SHA3_384") WHERE "SHA3_384" IS NOT NULL;
            CREATE INDEX "COMPONENT_SHA3_512_IDX" ON "COMPONENT" ("SHA3_512") WHERE "SHA3_512" IS NOT NULL;
        </sql>
    </changeSet>

    <changeSet id="v5.6.0-12" author="sahibamittal">
        <dropForeignKeyConstraint baseTableName="AFFECTEDVERSIONATTRIBUTION" constraintName="AFFECTEDVERSIONATTRIBUTION_VULNERABILITY_FK"/>
        <addForeignKeyConstraint baseColumnNames="VULNERABILITY" baseTableName="AFFECTEDVERSIONATTRIBUTION"
             constraintName="AFFECTEDVERSIONATTRIBUTION_VULNERABILITY_FK" deferrable="true"
             initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
             referencedColumnNames="ID" referencedTableName="VULNERABILITY" validate="true"/>

        <dropForeignKeyConstraint baseTableName="AFFECTEDVERSIONATTRIBUTION" constraintName="AFFECTEDVERSIONATTRIBUTION_VULNERABLESOFTWARE_FK"/>
        <addForeignKeyConstraint baseColumnNames="VULNERABLE_SOFTWARE" baseTableName="AFFECTEDVERSIONATTRIBUTION"
                                 constraintName="AFFECTEDVERSIONATTRIBUTION_VULNERABLESOFTWARE_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="VULNERABLESOFTWARE" validate="true"/>

        <dropForeignKeyConstraint baseTableName="ANALYSISCOMMENT" constraintName="ANALYSISCOMMENT_ANALYSIS_FK"/>
        <addForeignKeyConstraint baseColumnNames="ANALYSIS_ID" baseTableName="ANALYSISCOMMENT"
                                 constraintName="ANALYSISCOMMENT_ANALYSIS_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="ANALYSIS" validate="true"/>

        <dropForeignKeyConstraint baseTableName="ANALYSIS" constraintName="ANALYSIS_COMPONENT_FK"/>
        <addForeignKeyConstraint baseColumnNames="COMPONENT_ID" baseTableName="ANALYSIS" constraintName="ANALYSIS_COMPONENT_FK"
                                 deferrable="true" initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="COMPONENT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="ANALYSIS" constraintName="ANALYSIS_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="ANALYSIS" constraintName="ANALYSIS_PROJECT_FK"
                                 deferrable="true" initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="PROJECT" validate="true"/>
        
        <dropForeignKeyConstraint baseTableName="ANALYSIS" constraintName="ANALYSIS_VULNERABILITY_FK"/>
        <addForeignKeyConstraint baseColumnNames="VULNERABILITY_ID" baseTableName="ANALYSIS"
                                 constraintName="ANALYSIS_VULNERABILITY_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="VULNERABILITY" validate="true"/>
        
        <dropForeignKeyConstraint baseTableName="APIKEYS_TEAMS" constraintName="APIKEYS_TEAMS_TEAM_FK"/>
        <addForeignKeyConstraint baseColumnNames="TEAM_ID" baseTableName="APIKEYS_TEAMS"
                                 constraintName="APIKEYS_TEAMS_TEAM_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TEAM" validate="true"/>
        
        <dropForeignKeyConstraint baseTableName="APIKEYS_TEAMS" constraintName="APIKEYS_TEAMS_APIKEY_FK"/>
        <addForeignKeyConstraint baseColumnNames="APIKEY_ID" baseTableName="APIKEYS_TEAMS"
                                 constraintName="APIKEYS_TEAMS_APIKEY_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="APIKEY" validate="true"/>

        <dropForeignKeyConstraint baseTableName="BOM" constraintName="BOM_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="BOM" constraintName="BOM_PROJECT_FK"
                                 deferrable="true" initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="COMPONENTS_VULNERABILITIES" constraintName="COMPONENTS_VULNERABILITIES_COMPONENT_FK"/>
        <addForeignKeyConstraint baseColumnNames="COMPONENT_ID" baseTableName="COMPONENTS_VULNERABILITIES"
                                 constraintName="COMPONENTS_VULNERABILITIES_COMPONENT_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="COMPONENT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="COMPONENTS_VULNERABILITIES" constraintName="COMPONENTS_VULNERABILITIES_VULNERABILITY_FK"/>
        <addForeignKeyConstraint baseColumnNames="VULNERABILITY_ID" baseTableName="COMPONENTS_VULNERABILITIES"
                                 constraintName="COMPONENTS_VULNERABILITIES_VULNERABILITY_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="VULNERABILITY" validate="true"/>

        <dropForeignKeyConstraint baseTableName="COMPONENT" constraintName="COMPONENT_COMPONENT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PARENT_COMPONENT_ID" baseTableName="COMPONENT"
                                 constraintName="COMPONENT_COMPONENT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="COMPONENT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="COMPONENT" constraintName="COMPONENT_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="COMPONENT" constraintName="COMPONENT_PROJECT_FK"
                                 deferrable="true" initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="DEPENDENCYMETRICS" constraintName="DEPENDENCYMETRICS_COMPONENT_FK"/>
        <addForeignKeyConstraint baseColumnNames="COMPONENT_ID" baseTableName="DEPENDENCYMETRICS"
                                 constraintName="DEPENDENCYMETRICS_COMPONENT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="COMPONENT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="DEPENDENCYMETRICS" constraintName="DEPENDENCYMETRICS_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="DEPENDENCYMETRICS"
                                 constraintName="DEPENDENCYMETRICS_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="FINDINGATTRIBUTION" constraintName="FINDINGATTRIBUTION_COMPONENT_FK"/>
        <addForeignKeyConstraint baseColumnNames="COMPONENT_ID" baseTableName="FINDINGATTRIBUTION"
                                 constraintName="FINDINGATTRIBUTION_COMPONENT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="COMPONENT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="FINDINGATTRIBUTION" constraintName="FINDINGATTRIBUTION_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="FINDINGATTRIBUTION"
                                 constraintName="FINDINGATTRIBUTION_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="FINDINGATTRIBUTION" constraintName="FINDINGATTRIBUTION_VULNERABILITY_FK"/>
        <addForeignKeyConstraint baseColumnNames="VULNERABILITY_ID" baseTableName="FINDINGATTRIBUTION"
                                 constraintName="FINDINGATTRIBUTION_VULNERABILITY_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="VULNERABILITY" validate="true"/>

        <dropForeignKeyConstraint baseTableName="INTEGRITY_ANALYSIS" constraintName="INTEGRITY_ANALYSIS_COMPONENT_FK"/>
        <addForeignKeyConstraint baseColumnNames="COMPONENT_ID" baseTableName="INTEGRITY_ANALYSIS"
                                 constraintName="INTEGRITY_ANALYSIS_COMPONENT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="COMPONENT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="LDAPUSERS_PERMISSIONS" constraintName="LDAPUSERS_PERMISSIONS_LDAPUSER_FK"/>
        <addForeignKeyConstraint baseColumnNames="LDAPUSER_ID" baseTableName="LDAPUSERS_PERMISSIONS"
                                 constraintName="LDAPUSERS_PERMISSIONS_LDAPUSER_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="LDAPUSER" validate="true"/>

        <dropForeignKeyConstraint baseTableName="LDAPUSERS_PERMISSIONS" constraintName="LDAPUSERS_PERMISSIONS_PERMISSION_FK"/>
        <addForeignKeyConstraint baseColumnNames="PERMISSION_ID" baseTableName="LDAPUSERS_PERMISSIONS"
                                 constraintName="LDAPUSERS_PERMISSIONS_PERMISSION_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PERMISSION" validate="true"/>

        <dropForeignKeyConstraint baseTableName="LDAPUSERS_TEAMS" constraintName="LDAPUSERS_TEAMS_TEAM_FK"/>
        <addForeignKeyConstraint baseColumnNames="TEAM_ID" baseTableName="LDAPUSERS_TEAMS"
                                 constraintName="LDAPUSERS_TEAMS_TEAM_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TEAM" validate="true"/>

        <dropForeignKeyConstraint baseTableName="LDAPUSERS_TEAMS" constraintName="LDAPUSERS_TEAMS_LDAPUSER_FK"/>
        <addForeignKeyConstraint baseColumnNames="LDAPUSER_ID" baseTableName="LDAPUSERS_TEAMS"
                                 constraintName="LDAPUSERS_TEAMS_LDAPUSER_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="LDAPUSER" validate="true"/>

        <dropForeignKeyConstraint baseTableName="LICENSEGROUP_LICENSE" constraintName="LICENSEGROUP_LICENSE_LICENSEGROUP_FK"/>
        <addForeignKeyConstraint baseColumnNames="LICENSEGROUP_ID" baseTableName="LICENSEGROUP_LICENSE"
                                 constraintName="LICENSEGROUP_LICENSE_LICENSEGROUP_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="LICENSEGROUP" validate="true"/>

        <dropForeignKeyConstraint baseTableName="LICENSEGROUP_LICENSE" constraintName="LICENSEGROUP_LICENSE_LICENSE_FK"/>
        <addForeignKeyConstraint baseColumnNames="LICENSE_ID" baseTableName="LICENSEGROUP_LICENSE"
                                 constraintName="LICENSEGROUP_LICENSE_LICENSE_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="LICENSE" validate="true"/>

        <dropForeignKeyConstraint baseTableName="MANAGEDUSERS_PERMISSIONS" constraintName="MANAGEDUSERS_PERMISSIONS_MANAGEDUSER_FK"/>
        <addForeignKeyConstraint baseColumnNames="MANAGEDUSER_ID" baseTableName="MANAGEDUSERS_PERMISSIONS"
                                 constraintName="MANAGEDUSERS_PERMISSIONS_MANAGEDUSER_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="MANAGEDUSER" validate="true"/>

        <dropForeignKeyConstraint baseTableName="MANAGEDUSERS_PERMISSIONS" constraintName="MANAGEDUSERS_PERMISSIONS_PERMISSION_FK"/>
        <addForeignKeyConstraint baseColumnNames="PERMISSION_ID" baseTableName="MANAGEDUSERS_PERMISSIONS"
                                 constraintName="MANAGEDUSERS_PERMISSIONS_PERMISSION_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="PERMISSION" validate="true"/>

        <dropForeignKeyConstraint baseTableName="MANAGEDUSERS_TEAMS" constraintName="MANAGEDUSERS_TEAMS_TEAM_FK"/>
        <addForeignKeyConstraint baseColumnNames="TEAM_ID" baseTableName="MANAGEDUSERS_TEAMS"
                                 constraintName="MANAGEDUSERS_TEAMS_TEAM_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TEAM" validate="true"/>

        <dropForeignKeyConstraint baseTableName="MANAGEDUSERS_TEAMS" constraintName="MANAGEDUSERS_TEAMS_MANAGEDUSER_FK"/>
        <addForeignKeyConstraint baseColumnNames="MANAGEDUSER_ID" baseTableName="MANAGEDUSERS_TEAMS"
                                 constraintName="MANAGEDUSERS_TEAMS_MANAGEDUSER_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="MANAGEDUSER" validate="true"/>

        <dropForeignKeyConstraint baseTableName="MAPPEDLDAPGROUP" constraintName="MAPPEDLDAPGROUP_TEAM_FK"/>
        <addForeignKeyConstraint baseColumnNames="TEAM_ID" baseTableName="MAPPEDLDAPGROUP"
                                 constraintName="MAPPEDLDAPGROUP_TEAM_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TEAM" validate="true"/>

        <dropForeignKeyConstraint baseTableName="MAPPEDOIDCGROUP" constraintName="MAPPEDOIDCGROUP_OIDCGROUP_FK"/>
        <addForeignKeyConstraint baseColumnNames="GROUP_ID" baseTableName="MAPPEDOIDCGROUP"
                                 constraintName="MAPPEDOIDCGROUP_OIDCGROUP_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="OIDCGROUP" validate="true"/>

        <dropForeignKeyConstraint baseTableName="MAPPEDOIDCGROUP" constraintName="MAPPEDOIDCGROUP_TEAM_FK"/>
        <addForeignKeyConstraint baseColumnNames="TEAM_ID" baseTableName="MAPPEDOIDCGROUP"
                                 constraintName="MAPPEDOIDCGROUP_TEAM_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TEAM" validate="true"/>

        <dropForeignKeyConstraint baseTableName="NOTIFICATIONRULE" constraintName="NOTIFICATIONRULE_NOTIFICATIONPUBLISHER_FK"/>
        <addForeignKeyConstraint baseColumnNames="PUBLISHER" baseTableName="NOTIFICATIONRULE"
                                 constraintName="NOTIFICATIONRULE_NOTIFICATIONPUBLISHER_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="NOTIFICATIONPUBLISHER" validate="true"/>

        <dropForeignKeyConstraint baseTableName="NOTIFICATIONRULE_PROJECTS" constraintName="NOTIFICATIONRULE_PROJECTS_NOTIFICATIONRULE_FK"/>
        <addForeignKeyConstraint baseColumnNames="NOTIFICATIONRULE_ID" baseTableName="NOTIFICATIONRULE_PROJECTS"
                                 constraintName="NOTIFICATIONRULE_PROJECTS_NOTIFICATIONRULE_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="NOTIFICATIONRULE" validate="true"/>

        <dropForeignKeyConstraint baseTableName="NOTIFICATIONRULE_PROJECTS" constraintName="NOTIFICATIONRULE_PROJECTS_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="NOTIFICATIONRULE_PROJECTS"
                                 constraintName="NOTIFICATIONRULE_PROJECTS_PROJECT_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="NOTIFICATIONRULE_TAGS" constraintName="NOTIFICATIONRULE_TAGS_TAG_FK"/>
        <addForeignKeyConstraint baseColumnNames="TAG_ID" baseTableName="NOTIFICATIONRULE_TAGS"
                                 constraintName="NOTIFICATIONRULE_TAGS_TAG_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TAG" validate="true"/>

        <dropForeignKeyConstraint baseTableName="NOTIFICATIONRULE_TAGS" constraintName="NOTIFICATIONRULE_TAGS_NOTIFICATIONRULE_FK"/>
        <addForeignKeyConstraint baseColumnNames="NOTIFICATIONRULE_ID" baseTableName="NOTIFICATIONRULE_TAGS"
                                 constraintName="NOTIFICATIONRULE_TAGS_NOTIFICATIONRULE_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="NOTIFICATIONRULE" validate="true"/>

        <dropForeignKeyConstraint baseTableName="NOTIFICATIONRULE_TEAMS" constraintName="NOTIFICATIONRULE_TEAMS_NOTIFICATIONRULE_FK"/>
        <addForeignKeyConstraint baseColumnNames="NOTIFICATIONRULE_ID" baseTableName="NOTIFICATIONRULE_TEAMS"
                                 constraintName="NOTIFICATIONRULE_TEAMS_NOTIFICATIONRULE_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="NOTIFICATIONRULE" validate="true"/>

        <dropForeignKeyConstraint baseTableName="NOTIFICATIONRULE_TEAMS" constraintName="NOTIFICATIONRULE_TEAMS_TEAM_FK"/>
        <addForeignKeyConstraint baseColumnNames="TEAM_ID" baseTableName="NOTIFICATIONRULE_TEAMS"
                                 constraintName="NOTIFICATIONRULE_TEAMS_TEAM_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TEAM" validate="true"/>

        <dropForeignKeyConstraint baseTableName="OIDCUSERS_PERMISSIONS" constraintName="OIDCUSERS_PERMISSIONS_PERMISSION_FK"/>
        <addForeignKeyConstraint baseColumnNames="PERMISSION_ID" baseTableName="OIDCUSERS_PERMISSIONS"
                                 constraintName="OIDCUSERS_PERMISSIONS_PERMISSION_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PERMISSION" validate="true"/>

        <dropForeignKeyConstraint baseTableName="OIDCUSERS_PERMISSIONS" constraintName="OIDCUSERS_PERMISSIONS_OIDCUSER_FK"/>
        <addForeignKeyConstraint baseColumnNames="OIDCUSER_ID" baseTableName="OIDCUSERS_PERMISSIONS"
                                 constraintName="OIDCUSERS_PERMISSIONS_OIDCUSER_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="OIDCUSER" validate="true"/>

        <dropForeignKeyConstraint baseTableName="OIDCUSERS_TEAMS" constraintName="OIDCUSERS_TEAMS_OIDCUSER_FK"/>
        <addForeignKeyConstraint baseColumnNames="OIDCUSERS_ID" baseTableName="OIDCUSERS_TEAMS"
                                 constraintName="OIDCUSERS_TEAMS_OIDCUSER_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="OIDCUSER" validate="true"/>

        <dropForeignKeyConstraint baseTableName="OIDCUSERS_TEAMS" constraintName="OIDCUSERS_TEAMS_TEAM_FK"/>
        <addForeignKeyConstraint baseColumnNames="TEAM_ID" baseTableName="OIDCUSERS_TEAMS"
                                 constraintName="OIDCUSERS_TEAMS_TEAM_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TEAM" validate="true"/>

        <dropForeignKeyConstraint baseTableName="POLICYCONDITION" constraintName="POLICYCONDITION_POLICY_FK"/>
        <addForeignKeyConstraint baseColumnNames="POLICY_ID" baseTableName="POLICYCONDITION"
                                 constraintName="POLICYCONDITION_POLICY_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="POLICY" validate="true"/>

        <dropForeignKeyConstraint baseTableName="POLICYVIOLATION" constraintName="POLICYVIOLATION_COMPONENT_FK"/>
        <addForeignKeyConstraint baseColumnNames="COMPONENT_ID" baseTableName="POLICYVIOLATION"
                                 constraintName="POLICYVIOLATION_COMPONENT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="COMPONENT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="POLICYVIOLATION" constraintName="POLICYVIOLATION_POLICYCONDITION_FK"/>
        <addForeignKeyConstraint baseColumnNames="POLICYCONDITION_ID" baseTableName="POLICYVIOLATION"
                                 constraintName="POLICYVIOLATION_POLICYCONDITION_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="POLICYCONDITION" validate="true"/>

        <dropForeignKeyConstraint baseTableName="POLICYVIOLATION" constraintName="POLICYVIOLATION_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="POLICYVIOLATION"
                                 constraintName="POLICYVIOLATION_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="POLICY_PROJECTS" constraintName="POLICY_PROJECTS_POLICY_FK"/>
        <addForeignKeyConstraint baseColumnNames="POLICY_ID" baseTableName="POLICY_PROJECTS"
                                 constraintName="POLICY_PROJECTS_POLICY_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="POLICY" validate="true"/>

        <dropForeignKeyConstraint baseTableName="POLICY_PROJECTS" constraintName="POLICY_PROJECTS_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="POLICY_PROJECTS"
                                 constraintName="POLICY_PROJECTS_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="POLICY_TAGS" constraintName="POLICY_TAGS_POLICY_FK"/>
        <addForeignKeyConstraint baseColumnNames="POLICY_ID" baseTableName="POLICY_TAGS"
                                 constraintName="POLICY_TAGS_POLICY_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="POLICY" validate="true"/>

        <dropForeignKeyConstraint baseTableName="POLICY_TAGS" constraintName="POLICY_TAGS_TAG_FK"/>
        <addForeignKeyConstraint baseColumnNames="TAG_ID" baseTableName="POLICY_TAGS" constraintName="POLICY_TAGS_TAG_FK"
                                 deferrable="true" initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="TAG" validate="true"/>

        <dropForeignKeyConstraint baseTableName="PROJECT" constraintName="PROJECT_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PARENT_PROJECT_ID" baseTableName="PROJECT"
                                 constraintName="PROJECT_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="PROJECTMETRICS" constraintName="PROJECTMETRICS_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="PROJECTMETRICS"
                                 constraintName="PROJECTMETRICS_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="PROJECTS_TAGS" constraintName="PROJECTS_TAGS_TAG_FK"/>
        <addForeignKeyConstraint baseColumnNames="TAG_ID" baseTableName="PROJECTS_TAGS"
                                 constraintName="PROJECTS_TAGS_TAG_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TAG" validate="true"/>

        <dropForeignKeyConstraint baseTableName="PROJECTS_TAGS" constraintName="PROJECTS_TAGS_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="PROJECTS_TAGS"
                                 constraintName="PROJECTS_TAGS_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="PROJECT_ACCESS_TEAMS" constraintName="PROJECT_ACCESS_TEAMS_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="PROJECT_ACCESS_TEAMS"
                                 constraintName="PROJECT_ACCESS_TEAMS_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="PROJECT_ACCESS_TEAMS" constraintName="PROJECT_ACCESS_TEAMS_TEAM_FK"/>
        <addForeignKeyConstraint baseColumnNames="TEAM_ID" baseTableName="PROJECT_ACCESS_TEAMS"
                                 constraintName="PROJECT_ACCESS_TEAMS_TEAM_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TEAM" validate="true"/>

        <dropForeignKeyConstraint baseTableName="PROJECT_METADATA" constraintName="PROJECT_METADATA_PROJECT_ID_FK"/>
        <addForeignKeyConstraint baseTableName="PROJECT_METADATA" baseColumnNames="PROJECT_ID"
                                 constraintName="PROJECT_METADATA_PROJECT_ID_FK" deferrable="true" initiallyDeferred="true"
                                 referencedTableName="PROJECT" referencedColumnNames="ID"
                                 onDelete="CASCADE" onUpdate="NO ACTION" validate="true"/>

        <dropForeignKeyConstraint baseTableName="PROJECT_PROPERTY" constraintName="PROJECT_PROPERTY_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="PROJECT_PROPERTY"
                                 constraintName="PROJECT_PROPERTY_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="SERVICECOMPONENTS_VULNERABILITIES" constraintName="SERVICECOMPONENTS_VULNERABILITIES_VULNERABILITY_FK"/>
        <addForeignKeyConstraint baseColumnNames="VULNERABILITY_ID" baseTableName="SERVICECOMPONENTS_VULNERABILITIES"
                                 constraintName="SERVICECOMPONENTS_VULNERABILITIES_VULNERABILITY_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="VULNERABILITY" validate="true"/>

        <dropForeignKeyConstraint baseTableName="SERVICECOMPONENTS_VULNERABILITIES" constraintName="SERVICECOMPONENTS_VULNERABILITIES_SERVICECOMPONENT_FK"/>
        <addForeignKeyConstraint baseColumnNames="SERVICECOMPONENT_ID" baseTableName="SERVICECOMPONENTS_VULNERABILITIES"
                                 constraintName="SERVICECOMPONENTS_VULNERABILITIES_SERVICECOMPONENT_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="SERVICECOMPONENT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="SERVICECOMPONENT" constraintName="SERVICECOMPONENT_SERVICECOMPONENT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PARENT_SERVICECOMPONENT_ID" baseTableName="SERVICECOMPONENT"
                                 constraintName="SERVICECOMPONENT_SERVICECOMPONENT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="SERVICECOMPONENT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="SERVICECOMPONENT" constraintName="SERVICECOMPONENT_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="SERVICECOMPONENT"
                                 constraintName="SERVICECOMPONENT_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="TEAMS_PERMISSIONS" constraintName="TEAMS_PERMISSIONS_TEAM_FK"/>
        <addForeignKeyConstraint baseColumnNames="TEAM_ID" baseTableName="TEAMS_PERMISSIONS"
                                 constraintName="TEAMS_PERMISSIONS_TEAM_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TEAM" validate="true"/>

        <dropForeignKeyConstraint baseTableName="TEAMS_PERMISSIONS" constraintName="TEAMS_PERMISSIONS_PERMISSION_FK"/>
        <addForeignKeyConstraint baseColumnNames="PERMISSION_ID" baseTableName="TEAMS_PERMISSIONS"
                                 constraintName="TEAMS_PERMISSIONS_PERMISSION_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PERMISSION" validate="true"/>

        <dropForeignKeyConstraint baseTableName="VEX" constraintName="VEX_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="VEX" constraintName="VEX_PROJECT_FK"
                                 deferrable="true" initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="VIOLATIONANALYSISCOMMENT" constraintName="VIOLATIONANALYSISCOMMENT_VIOLATIONANALYSIS_FK"/>
        <addForeignKeyConstraint baseColumnNames="VIOLATIONANALYSIS_ID" baseTableName="VIOLATIONANALYSISCOMMENT"
                                 constraintName="VIOLATIONANALYSISCOMMENT_VIOLATIONANALYSIS_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="VIOLATIONANALYSIS" validate="true"/>

        <dropForeignKeyConstraint baseTableName="VIOLATIONANALYSIS" constraintName="VIOLATIONANALYSIS_COMPONENT_FK"/>
        <addForeignKeyConstraint baseColumnNames="COMPONENT_ID" baseTableName="VIOLATIONANALYSIS"
                                 constraintName="VIOLATIONANALYSIS_COMPONENT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="COMPONENT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="VIOLATIONANALYSIS" constraintName="VIOLATIONANALYSIS_POLICYVIOLATION_FK"/>
        <addForeignKeyConstraint baseColumnNames="POLICYVIOLATION_ID" baseTableName="VIOLATIONANALYSIS"
                                 constraintName="VIOLATIONANALYSIS_POLICYVIOLATION_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="POLICYVIOLATION" validate="true"/>

        <dropForeignKeyConstraint baseTableName="VIOLATIONANALYSIS" constraintName="VIOLATIONANALYSIS_PROJECT_FK"/>
        <addForeignKeyConstraint baseColumnNames="PROJECT_ID" baseTableName="VIOLATIONANALYSIS"
                                 constraintName="VIOLATIONANALYSIS_PROJECT_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="PROJECT" validate="true"/>

        <dropForeignKeyConstraint baseTableName="VULNERABILITIES_TAGS" constraintName="VULNERABILITIES_TAGS_TAG_FK"/>
        <addForeignKeyConstraint baseColumnNames="TAG_ID" baseTableName="VULNERABILITIES_TAGS"
                                 constraintName="VULNERABILITIES_TAGS_TAG_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="TAG" validate="true"/>

        <dropForeignKeyConstraint baseTableName="VULNERABILITIES_TAGS" constraintName="VULNERABILITIES_TAGS_VULNERABILITY_FK"/>
        <addForeignKeyConstraint baseColumnNames="VULNERABILITY_ID" baseTableName="VULNERABILITIES_TAGS"
                                 constraintName="VULNERABILITIES_TAGS_VULNERABILITY_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="VULNERABILITY" validate="true"/>

        <dropForeignKeyConstraint baseTableName="VULNERABLESOFTWARE_VULNERABILITIES" constraintName="VULNERABLESOFTWARE_VULNERABILITIES_VULNERABILITY_FK"/>
        <addForeignKeyConstraint baseColumnNames="VULNERABILITY_ID" baseTableName="VULNERABLESOFTWARE_VULNERABILITIES"
                                 constraintName="VULNERABLESOFTWARE_VULNERABILITIES_VULNERABILITY_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="VULNERABILITY" validate="true"/>

        <dropForeignKeyConstraint baseTableName="VULNERABLESOFTWARE_VULNERABILITIES" constraintName="VULNERABLESOFTWARE_VULNERABILITIES_VULNERABLESOFTWARE_FK"/>
        <addForeignKeyConstraint baseColumnNames="VULNERABLESOFTWARE_ID"
                                 baseTableName="VULNERABLESOFTWARE_VULNERABILITIES"
                                 constraintName="VULNERABLESOFTWARE_VULNERABILITIES_VULNERABLESOFTWARE_FK" deferrable="true"
                                 initiallyDeferred="true" onDelete="CASCADE" onUpdate="NO ACTION"
                                 referencedColumnNames="ID" referencedTableName="VULNERABLESOFTWARE" validate="true"/>

        <dropForeignKeyConstraint baseTableName="WORKFLOW_STATE" constraintName="WORKFLOW_STATE_WORKFLOW_STATE_FK"/>
        <addForeignKeyConstraint baseColumnNames="PARENT_STEP_ID" baseTableName="WORKFLOW_STATE"
                                 constraintName="WORKFLOW_STATE_WORKFLOW_STATE_FK" deferrable="true" initiallyDeferred="true"
                                 onDelete="CASCADE" onUpdate="NO ACTION" referencedColumnNames="ID"
                                 referencedTableName="WORKFLOW_STATE" validate="true"/>
    </changeSet>

    <changeSet id="v5.6.0-13-dev" author="pkwiatkowski1">
        <addColumn tableName="APIKEY">
            <column name="IS_LEGACY" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="PUBLIC_ID" type="VARCHAR(255)">
                <constraints nullable="true"/>
            </column>
        </addColumn>
        <addUniqueConstraint columnNames="PUBLIC_ID" constraintName="APIKEY_PUBLIC_IDX" tableName="APIKEY"/>

        <modifyDataType tableName="VULNERABILITY" columnName="CVSSV2BASESCORE" newDataType="NUMERIC(1, 1)"/>
        <modifyDataType tableName="VULNERABILITY" columnName="CVSSV2EXPLOITSCORE" newDataType="NUMERIC(1, 1)"/>
        <modifyDataType tableName="VULNERABILITY" columnName="CVSSV2IMPACTSCORE" newDataType="NUMERIC(1, 1)"/>
        <modifyDataType tableName="VULNERABILITY" columnName="CVSSV3BASESCORE" newDataType="NUMERIC(1, 1)"/>
        <modifyDataType tableName="VULNERABILITY" columnName="CVSSV3EXPLOITSCORE" newDataType="NUMERIC(1, 1)"/>
        <modifyDataType tableName="VULNERABILITY" columnName="CVSSV3IMPACTSCORE" newDataType="NUMERIC(1, 1)"/>
        <modifyDataType tableName="VULNERABILITY" columnName="FRIENDLYVULNID" newDataType="VARCHAR(255)"/>
        <modifyDataType tableName="VULNERABILITY" columnName="OWASPRRBUSINESSIMPACTSCORE" newDataType="NUMERIC(1, 1)"/>
        <modifyDataType tableName="VULNERABILITY" columnName="OWASPRRLIKELIHOODSCORE" newDataType="NUMERIC(1, 1)"/>
        <modifyDataType tableName="VULNERABILITY" columnName="OWASPRRTECHNICALIMPACTSCORE" newDataType="NUMERIC(1, 1)"/>
        <modifyDataType tableName="VULNERABILITY_POLICY_BUNDLE" columnName="URL" newDataType="VARCHAR(255)"/>
        <modifyDataType tableName="EPSS" columnName="PERCENTILE" newDataType="NUMERIC(3, 5)"/>
        <modifyDataType tableName="EPSS" columnName="SCORE" newDataType="NUMERIC(3, 5)"/>
    </changeSet>

    <changeSet id="v5.6.0-13" author="jhoward-lm">
        <createTable ifNotExists="true" tableName="ROLE">
            <column autoIncrement="true" name="ID" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="ROLE_PK" />
            </column>

            <column name="NAME" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="ROLE_NAME_IDX"
                    validateNullable="true" validateUnique="true" />
            </column>

            <column name="DESCRIPTION" type="VARCHAR(255)">
                <constraints nullable="true" />
            </column>
        </createTable>

        <createTable ifNotExists="true" tableName="ROLES_PERMISSIONS">
            <column name="ROLE_ID" type="BIGINT">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="ROLES_PERMISSIONS_IDX"
                    foreignKeyName="ROLES_PERMISSIONS_ROLE_FK"
                    referencedTableName="ROLE" referencedColumnNames="ID"
                    deferrable="true" initiallyDeferred="true" deleteCascade="false"
                    validateUnique="true" validateForeignKey="true" />
            </column>

            <column name="PERMISSION_ID" type="BIGINT">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="ROLES_PERMISSIONS_IDX"
                    foreignKeyName="ROLES_PERMISSIONS_PERMISSION_FK"
                    referencedTableName="PERMISSION" referencedColumnNames="ID"
                    deferrable="true" initiallyDeferred="true" deleteCascade="false"
                    validateUnique="true" validateForeignKey="true" />
            </column>
        </createTable>

        <createTable ifNotExists="true" tableName="PROJECT_ACCESS_ROLES">
            <column autoIncrement="true" name="ID" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PROJECT_ACCESS_ROLE_PK" />
            </column>

            <column name="PROJECT_ID" type="BIGINT">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="PROJECT_ACCESS_ROLES_COMPOSITE_IDX"
                    foreignKeyName="PROJECT_ACCESS_ROLES_PROJECT_FK"
                    referencedTableName="PROJECT" referencedColumnNames="ID"
                    deferrable="true" initiallyDeferred="true" deleteCascade="false"
                    validateUnique="true" validateForeignKey="true" />
            </column>

            <column name="ROLE_ID" type="BIGINT">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="PROJECT_ACCESS_ROLES_COMPOSITE_IDX"
                    foreignKeyName="PROJECT_ACCESS_ROLES_ROLE_FK"
                    referencedTableName="ROLE" referencedColumnNames="ID"
                    deferrable="true" initiallyDeferred="true" deleteCascade="false"
                    validateUnique="true" validateForeignKey="true" />
            </column>
        </createTable>

        <createIndex indexName="PROJECT_ACCESS_ROLES_PROJECT_ID_IDX" tableName="PROJECT_ACCESS_ROLES">
            <column name="PROJECT_ID" />
        </createIndex>

        <createIndex indexName="PROJECT_ACCESS_ROLES_ROLE_ID_IDX" tableName="PROJECT_ACCESS_ROLES">
            <column name="ROLE_ID" />
        </createIndex>

        <createTable ifNotExists="true" tableName="LDAPUSERS_PROJECTS_ROLES">
            <column name="LDAPUSER_ID" type="BIGINT">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="LDAPUSERS_PROJECTS_ROLES_COMPOSITE_IDX"
                    foreignKeyName="LDAPUSERS_PROJECTS_ROLES_LDAPUSER_FK"
                    referencedTableName="LDAPUSER" referencedColumnNames="ID"
                    deferrable="true" initiallyDeferred="true" deleteCascade="false"
                    validateUnique="true" validateForeignKey="true" />
            </column>

            <column name="PROJECT_ACCESS_ROLE_ID" type="BIGINT">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="LDAPUSERS_PROJECTS_ROLES_COMPOSITE_IDX"
                    foreignKeyName="LDAPUSERS_PROJECTS_ROLES_PROJECT_ACCESS_ROLE_FK"
                    referencedTableName="PROJECT_ACCESS_ROLES" referencedColumnNames="ID"
                    deferrable="true" initiallyDeferred="true" deleteCascade="false"
                    validateUnique="true" validateForeignKey="true" />
            </column>
        </createTable>

        <createIndex indexName="LDAPUSERS_PROJECTS_ROLES_LDAPUSER_ID_IDX" tableName="LDAPUSERS_PROJECTS_ROLES">
            <column name="LDAPUSER_ID" />
        </createIndex>

        <createIndex indexName="LDAPUSERS_PROJECTS_ROLES_ROLE_ID_IDX" tableName="LDAPUSERS_PROJECTS_ROLES">
            <column name="PROJECT_ACCESS_ROLE_ID" />
        </createIndex>

        <createTable ifNotExists="true" tableName="MANAGEDUSERS_PROJECTS_ROLES">
            <column name="MANAGEDUSER_ID" type="BIGINT">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="MANAGEDUSERS_PROJECTS_ROLES_COMPOSITE_IDX"
                    foreignKeyName="MANAGEDUSERS_PROJECTS_ROLES_MANAGEDUSER_FK"
                    referencedTableName="MANAGEDUSER" referencedColumnNames="ID"
                    deferrable="true" initiallyDeferred="true" deleteCascade="false"
                    validateUnique="true" validateForeignKey="true" />
            </column>

            <column name="PROJECT_ACCESS_ROLE_ID" type="BIGINT">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="MANAGEDUSERS_PROJECTS_ROLES_COMPOSITE_IDX"
                    foreignKeyName="MANAGEDUSERS_PROJECTS_ROLES_PROJECT_ACCESS_ROLE_FK"
                    referencedTableName="PROJECT_ACCESS_ROLES" referencedColumnNames="ID"
                    deferrable="true" initiallyDeferred="true" deleteCascade="false" 
                    validateUnique="true" validateForeignKey="true" />
            </column>
        </createTable>

        <createIndex indexName="MANAGEDUSERS_PROJECTS_ROLES_MANAGEDUSER_ID_IDX" tableName="MANAGEDUSERS_PROJECTS_ROLES">
            <column name="MANAGEDUSER_ID" />
        </createIndex>

        <createIndex indexName="MANAGEDUSERS_PROJECTS_ROLES_ROLE_ID_IDX" tableName="MANAGEDUSERS_PROJECTS_ROLES">
            <column name="PROJECT_ACCESS_ROLE_ID" />
        </createIndex>

        <createTable ifNotExists="true" tableName="OIDCUSERS_PROJECTS_ROLES">
            <column name="OIDCUSER_ID" type="BIGINT">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="OIDCUSERS_PROJECTS_ROLES_COMPOSITE_IDX"
                    foreignKeyName="OIDCUSERS_PROJECTS_ROLES_OIDCUSER_FK"
                    referencedTableName="OIDCUSER" referencedColumnNames="ID"
                    deferrable="true" initiallyDeferred="true" deleteCascade="false" 
                    validateUnique="true" validateForeignKey="true" />
            </column>

            <column name="PROJECT_ACCESS_ROLE_ID" type="BIGINT">
                <constraints nullable="false" unique="true"
                    uniqueConstraintName="OIDCUSERS_PROJECTS_ROLES_COMPOSITE_IDX"
                    foreignKeyName="OIDCUSERS_PROJECTS_ROLES_PROJECT_ACCESS_ROLE_FK"
                    referencedTableName="PROJECT_ACCESS_ROLES" referencedColumnNames="ID"
                    deferrable="true" initiallyDeferred="true" deleteCascade="false" 
                    validateUnique="true" validateForeignKey="true" />
            </column>
        </createTable>
    </changeSet>
</databaseChangeLog>
