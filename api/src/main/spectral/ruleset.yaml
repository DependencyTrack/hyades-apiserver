# This file is part of Dependency-Track.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0
# Copyright (c) OWASP Foundation. All Rights Reserved.
extends:
- ["spectral:oas", "all"]
- ["./zalando.yaml", "all"]
formats:
- "oas3"
rules:
  # Override the path naming rule to exclude CSAF extension point paths
  # These paths use "vuln.datasource" which doesn't conform to lowercase-with-hyphens
  must-use-lowercase-with-hypens-for-path-segements:
    message: Path segments have to be lowercase separate words with hyphens
    description: MUST use lowercase separate words with hyphens for path segments [129]
    documentationUrl: https://opensource.zalando.com/restful-api-guidelines/#129
    severity: error
    # Exclude CSAF extension point paths from this rule
    given: $.paths[?(!@property.match(/^\/extension-points\/vuln\.datasource\/extensions\/csaf\//))]~
    then:
      function: pattern
      functionOptions:
        match: ^(?=((([\/a-z][a-z0-9\-\/]*)?({[^}]*})?)+))\1$